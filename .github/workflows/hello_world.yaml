# workflow name
name: test workflow

# event type
on:
  push:
    branches: [ main ]
#   pull_request:
#     branches:
#       - main
#   workflow_dispatch:
#

jobs:
  goodbye:
    runs-on: ubuntu-latest
    steps:
      - name: Check Path
        working-directory: .
        run: pwd
        
      - name: list folder
        working-directory: .
        run: |
          ls -la
    
      - name: checkout repo
        uses: actions/checkout@v3 # checkout the repository content
        
      - name: list folder again
        working-directory: .
        run: |
          ls -la
        
      - name: Dump GitHub context
        id: github_context_step
        run: echo '${{ toJSON(github) }}'
        
      - name: Dump pusher
        run: echo '${{ toJSON(github.event.pusher) }}'
        
      - name: setup python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # install the python version needed

      #- name: install python packages
       # run: |
        #  python -m pip install --upgrade pip
         # pip install -r requirements.txt
        
      - name: Execute Verify Access script
        env: 
          Test_Parameter: ${{ github.actor }}
        run: python ./.github/scripts/verify_access.py '${{ toJSON(github.event.pusher) }}'
        
      - name: Send Test Web Hook
        run: |
          echo "Testing active webhook from worlflow"
          myjson = $(cat <<-END
            {
              "data" : {
                "project": "My test project",
                "results": "OK"
              }
            }
          END
          )
          echo: "test json = $myjson"
          curl -X POST "http://chimera.isi.it:8000" -H "Content-Type: application/json" -H "accept: application/json" -H "x-token: ${{ secrets.TEST_SECRET }}" -d "$myjson"

        
      - name: Say Goodbye
        run: echo "Goodbye world"
        shell: bash
